# hostcfg.txt - should be run from your build environment

# log onto the host linux instance
ssh USER@HOST_IP_ADDR ... enter pwd for local user account
  
# On first setup of the host machine create
mkdir xdk
mkdir xqiz.it
mkdir xqiz.it/lib
mkdir xqiz.it/platform
# cd into 
cd xqiz.it
echo '{"dName":"C=USA,S=MA,L=Lexington,OU=hosting,O=xqiz.it,CN=host.xqiz.it",
"cert-provider":"certbot",
"httpPort":80,
"httpsPort":443
}' > platform/cfg.json

# this only kept for reference if we ever decide to have a receiver intermediate
# instance between the outside network and 'live' xtc instance
#echo '{"dName":"C=USA,S=MA,L=Lexington,OU=hosting,O=xqiz.it,CN=host.xqiz.it",
#"cert-provider":"certbot",
#"httpPort":80,
#"httpsPort":443,
#"proxies":["192.168.1.30"]
#}' > platform/cfg.json
  
# copy the latest builds to HOST_IP_ADDR
# Build paths may be different but we should probably be opinionated  
scp -r ~/xtclang/xvm/xdk/build/install/xdk/* USER@HOST_IP_ADDR:~/xdk
scp -r ~/xtclang/platform/lib/* USER@HOST_IP_ADDR:~/xqiz.it/lib

# ensure that "openssl" and "keytool" are installed
# install the "certbot"
sudo apt install certbot

# start the platform in debug mode
xec -L xqiz.it/lib/ kernel.xqiz.it $password
# or in "production" mode
nohup xec -L xqiz.it/lib/ kernel.xqiz.it $password &> platform.out&USER
